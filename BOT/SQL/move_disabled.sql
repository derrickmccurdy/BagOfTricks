#on app server
#log the results to a text file
\T /tmp/ls23_disabled.txt ;
# find all the disabled accounts on that list server
select accounts.AccountID, accounts.DateDisabled, settings.ListServer  from system.accounts as accounts inner join emarketing.settings as settings on accounts.AccountID = settings.AccountID where accounts.AccountEnabled = 0 and accounts.DateDisabled < now() and date_format(accounts.DateDisabled, '%Y-%m-%d') <> "0000-00-00" and settings.ListServer = "67.217.39.119" ;
# stop logging 
\T /dev/null ;

#on local
#get results file
scp app:/tmp/ls23_disabled.txt

#edit the file and turn each line into an rsync statement


#on the old list server
#run each rsync command
#comment out list server transfer script in crontab





#on app server
#set the new list server location
update emarketing.settings set ListServer = "67.217.39.117" where AccountID in (6359, 6350, 937, 939, 941, 945, 948, 949, 950, 952, 959, 971, 960, 975, 931, 973, 974, 978, 981, 982, 994, 1011, 996, 997, 999, 1001, 1005, 1009, 1015, 1046, 6351, 1125, 1134, 1126, 1129, 1130, 1132, 1133, 1135, 1206, 1186, 1191, 1220, 1228, 1229, 1230, 1245, 1826, 1358, 1394, 1360, 1361, 1368, 1369, 1371, 1372, 1375, 1379, 1380, 1399, 1407, 1408, 1413, 1415, 1421, 1450, 6355, 1446, 1449, 1479, 6361, 1722, 1741, 1789, 1924, 1903, 1932, 1988, 6358, 2249, 2296, 2384, 2375, 2381, 2385, 2393, 2397, 2408, 2399, 2404, 2407, 2433, 2445, 2548, 2552, 2557, 2559, 2611, 2713, 2689, 2691, 2693, 2724, 2711, 2745, 2741, 2744, 2748, 2749, 2751, 2761, 2756, 2760, 2764, 2773, 2774, 2783, 2785, 2787, 2791, 2820, 2799, 2801, 2816, 2953, 3428, 3389, 3390, 3412, 3425, 3427, 3430, 3431, 3432, 3433, 3434, 3435, 3617, 3626, 3751, 3760, 3761, 3763, 3764, 3971, 3801, 3990, 3787, 3816, 3765, 3766, 3768, 3772, 3773, 3782, 3796, 3803, 3815, 3818, 3823, 3825, 3833, 3977, 3861, 3972, 3974, 3984, 3982, 4114, 4148, 4186, 4282, 4288, 4326, 4329, 4330, 4345, 4347, 4363, 4367, 4368, 4369, 4394, 4374, 4375, 4377, 4378, 4379, 4380, 4392, 4395, 4396, 4397, 4433, 4414, 4450, 4438, 4544, 4487, 4413, 4437, 4451, 4488, 4546, 4547, 4582, 4584, 5065, 6363, 5085, 5034, 5099, 5070, 5079, 5084, 5102, 5100, 5101, 5103, 5104, 5107, 5105, 5136, 5133, 5134, 5138, 5140, 5625, 5303, 5304, 5305, 5310, 5522, 5521, 5526, 5532, 5527, 5528, 5614, 5630, 5615, 5616, 5631, 5870, 5872, 5874, 6001, 6003, 6010, 6014, 6046, 6061, 6068, 6174, 6175, 6177, 6349, 6362, 6372, 6319, 6360, 6367, 6713, 6699, 6700, 6701, 6702, 6714, 6715, 6801, 6804, 6832, 6888, 6928, 6931, 6933, 6938, 6979, 7080, 7086, 7063, 7064, 7065, 7067, 7069, 7070, 7071, 7073, 7082, 7079, 7078, 7090, 7089, 7094, 7095, 7103, 7113, 7122, 7123, 7125, 7124, 7127, 7135, 7129, 7132, 7149, 7152, 7247, 7248, 7250, 7285, 7252, 7289, 7286, 7330, 7339) ;

# remove entries from transfers table. 
delete from emarketing.list_server_transfers where AccountID in(6359, 6350, 937, 939, 941, 945, 948, 949, 950, 952, 959, 971, 960, 975, 931, 973, 974, 978, 981, 982, 994, 1011, 996, 997, 999, 1001, 1005, 1009, 1015, 1046, 6351, 1125, 1134, 1126, 1129, 1130, 1132, 1133, 1135, 1206, 1186, 1191, 1220, 1228, 1229, 1230, 1245, 1826, 1358, 1394, 1360, 1361, 1368, 1369, 1371, 1372, 1375, 1379, 1380, 1399, 1407, 1408, 1413, 1415, 1421, 1450, 6355, 1446, 1449, 1479, 6361, 1722, 1741, 1789, 1924, 1903, 1932, 1988, 6358, 2249, 2296, 2384, 2375, 2381, 2385, 2393, 2397, 2408, 2399, 2404, 2407, 2433, 2445, 2548, 2552, 2557, 2559, 2611, 2713, 2689, 2691, 2693, 2724, 2711, 2745, 2741, 2744, 2748, 2749, 2751, 2761, 2756, 2760, 2764, 2773, 2774, 2783, 2785, 2787, 2791, 2820, 2799, 2801, 2816, 2953, 3428, 3389, 3390, 3412, 3425, 3427, 3430, 3431, 3432, 3433, 3434, 3435, 3617, 3626, 3751, 3760, 3761, 3763, 3764, 3971, 3801, 3990, 3787, 3816, 3765, 3766, 3768, 3772, 3773, 3782, 3796, 3803, 3815, 3818, 3823, 3825, 3833, 3977, 3861, 3972, 3974, 3984, 3982, 4114, 4148, 4186, 4282, 4288, 4326, 4329, 4330, 4345, 4347, 4363, 4367, 4368, 4369, 4394, 4374, 4375, 4377, 4378, 4379, 4380, 4392, 4395, 4396, 4397, 4433, 4414, 4450, 4438, 4544, 4487, 4413, 4437, 4451, 4488, 4546, 4547, 4582, 4584, 5065, 6363, 5085, 5034, 5099, 5070, 5079, 5084, 5102, 5100, 5101, 5103, 5104, 5107, 5105, 5136, 5133, 5134, 5138, 5140, 5625, 5303, 5304, 5305, 5310, 5522, 5521, 5526, 5532, 5527, 5528, 5614, 5630, 5615, 5616, 5631, 5870, 5872, 5874, 6001, 6003, 6010, 6014, 6046, 6061, 6068, 6174, 6175, 6177, 6349, 6362, 6372, 6319, 6360, 6367, 6713, 6699, 6700, 6701, 6702, 6714, 6715, 6801, 6804, 6832, 6888, 6928, 6931, 6933, 6938, 6979, 7080, 7086, 7063, 7064, 7065, 7067, 7069, 7070, 7071, 7073, 7082, 7079, 7078, 7090, 7089, 7094, 7095, 7103, 7113, 7122, 7123, 7125, 7124, 7127, 7135, 7129, 7132, 7149, 7152, 7247, 7248, 7250, 7285, 7252, 7289, 7286, 7330, 7339) and new_list_server = "67.217.39.117" and former_list_server = "67.217.39.119" ;

#on old list server
# uncomment  list server transfer script in crontab
